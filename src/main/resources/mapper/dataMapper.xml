<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.wegether.apD.mapper.DataMapper">

<!--  자료 목록 조회  -->
    <select id="selectAll" resultType="DATADTO">
        SELECT D.ID, DATA_TITLE, DATA_CONTENT,DATA_PRICE ,DATA_SCHOOL ,DATA_MAJOR ,DATA_REGISTER_DATE, DATA_UPDATE_DATE, DATA_READ_COUNT, D.MEMBER_ID, MEMBER_NAME
        FROM
        (
        SELECT ROWNUM R, D.ID, DATA_TITLE, DATA_CONTENT,DATA_PRICE ,DATA_SCHOOL ,DATA_MAJOR ,DATA_REGISTER_DATE, DATA_UPDATE_DATE, DATA_READ_COUNT, D.MEMBER_ID, MEMBER_NAME
        FROM TBL_MEMBER M JOIN TBL_DATA D
        <![CDATA[
            ON M.ID = D.MEMBER_ID AND ROWNUM <= #{pagination.page} * #{pagination.rowCount}
        ]]>
        ORDER BY
        <choose>
            <when test="search.order == 'popular'">
                DATA_READ_COUNT
            </when>
            <otherwise>
                D.ID
            </otherwise>
        </choose>
        DESC
        <![CDATA[
        ) P WHERE R > (#{pagination.page} - 1) * #{pagination.rowCount}
        ]]>
    </select>

    <!--  자료 추가  -->
    <insert id="insert">
        <selectKey keyProperty="id" order="BEFORE" resultType="DATADTO">
            SELECT SEQ_DATA.NEXTVAL FROM DUAL
        </selectKey>
        INSERT INTO TBL_DATA(ID, DATA_TITLE, DATA_CONTENT, MEMBER_ID)
        VALUES(#{id}, #{DATATitle}, #{DATAContent}, #{memberId})
    </insert>

    <!--  자료 상세 조회  -->
    <select id="select" resultType="DATADTO">
        SELECT D.ID, DATA_TITLE, DATA_CONTENT, DATA_REGISTER_DATE, DATA_UPDATE_DATE, DATA_READ_COUNT, D.MEMBER_ID, MEMBER_NAME
        FROM TBL_MEMBER M JOIN TBL_DATA P
        ON M.ID = D.MEMBER_ID AND D.ID = #{id}
    </select>
    
</mapper>